<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Pixelblumen-Wiese</title>
<style>
  body { margin:0; overflow:hidden; background:#87CEEB; font-family:monospace; }
  #ui { position:absolute; top:10px; left:10px; z-index:10; }
  button { margin:3px; padding:5px 8px; cursor:pointer; }
  #log { position:absolute; bottom:10px; left:10px; width:400px; max-height:200px; 
         overflow-y:auto; background:rgba(255,255,255,0.7); border:1px solid #0a0; padding:5px; font-size:12px; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui">
  <button id="rainBtn">ğŸŒ§ Regen</button>
  <button id="sunBtn">â˜€ï¸ Sonne</button>
  <button id="beeBtn">ğŸ Bienenfangen</button>
  <button id="saveBtn">ğŸ’¾ Speichern</button>
  <button id="loadBtn">ğŸ“‚ Laden</button>
  <input type="file" id="fileInput" style="display:none" accept=".json">
</div>
<div id="log"></div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const logDiv = document.getElementById('log');
function log(text){ const p=document.createElement('div'); p.textContent=text; logDiv.appendChild(p); logDiv.scrollTop=logDiv.scrollHeight; }

// --- Spielzustand ---
let game = {
  flowers: [],  // {x,y,size,health}
  bees: [],     // {x,y,vx,vy,caught}
  muldes: [],   // {x,y,water}
  sun: 1,
  rain:false,
  nectar:0
};

// --- Landschafts-HÃ¼gel ---
function drawTerrain(){
  ctx.fillStyle='#228B22';
  ctx.beginPath();
  ctx.moveTo(0,canvas.height-100);
  for(let i=0;i<canvas.width;i++){
    let y = canvas.height-100-20*Math.sin(i/100)-15*Math.sin(i/50);
    ctx.lineTo(i,y);
  }
  ctx.lineTo(canvas.width,canvas.height);
  ctx.lineTo(0,canvas.height);
  ctx.fill();
}

// --- Blume als Pixelart ---
function drawFlower(f){
  const sway = Math.sin(Date.now()/500 + f.x) * 2;
  const size = 5+15*f.size;
  // Stiel
  ctx.fillStyle='#0a0';
  ctx.fillRect(f.x-2+sway,f.y,4,30*f.size);
  // BlÃ¤tter
  ctx.fillRect(f.x-6+sway,f.y+10*f.size,4,10*f.size);
  ctx.fillRect(f.x+2+sway,f.y+15*f.size,4,10*f.size);
  // BlÃ¼te (Pixel-Art)
  ctx.fillStyle='#ffcc00';
  for(let dx=-2;dx<=2;dx++){
    for(let dy=-2;dy<=2;dy++){
      if(Math.abs(dx)+Math.abs(dy)<=2){
        ctx.fillRect(f.x+dx+sway,f.y-5*dy,3,3);
      }
    }
  }
}

// --- Bienen ---
function spawnBees(n){
  for(let i=0;i<n;i++){
    game.bees.push({x:Math.random()*canvas.width, y:Math.random()*100+50,
                    vx:1+Math.random()*2, vy:(Math.random()-0.5)*1, caught:false});
  }
}

// --- Regen ---
let drops=[];
function drawRain(){
  ctx.fillStyle='rgba(0,0,255,0.5)';
  drops.forEach(d=>{
    ctx.fillRect(d.x,d.y,2,10);
    d.y+=d.vy;
    if(d.y>canvas.height-100){
      // trifft Mulde?
      game.muldes.forEach(m=>{
        const dx=d.x-m.x;
        const dy=d.y-m.y;
        if(Math.sqrt(dx*dx+dy*dy)<20){ m.water+=0.5; }
      });
      d.y=Math.random()*-200;
      d.x=Math.random()*canvas.width;
    }
  });
}

// --- Main Loop ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Himmel
  ctx.fillStyle='#87CEEB'; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Sonne
  ctx.beginPath(); ctx.arc(100,100,50,0,2*Math.PI); ctx.fillStyle='#fff200'; ctx.fill();

  // Wolken
  ctx.fillStyle='#fff';
  ctx.beginPath();
  ctx.arc(400,80,40,0,Math.PI*2);
  ctx.arc(440,80,35,0,Math.PI*2);
  ctx.arc(420,60,30,0,Math.PI*2);
  ctx.fill();

  // HÃ¼gel/Wiese
  drawTerrain();

  // Mulden
  game.muldes.forEach(m=>{
    ctx.fillStyle='#0077aa';
    ctx.beginPath();
    ctx.ellipse(m.x,m.y,20,10,0,0,2*Math.PI);
    ctx.fill();
  });

  // Blumen
  game.flowers.forEach(f=>{
    // Wachstum
    if(f.health>0){
      const growthRate = 0.001*(1+game.sun+game.nectar+(f.muldeWater||0));
      f.size += growthRate;
      if(f.size>1) f.size=1;
    }
    drawFlower(f);
  });

  // Regen zeichnen
  if(game.rain){
    if(drops.length<200) for(let i=drops.length;i<200;i++){ drops.push({x:Math.random()*canvas.width,y:Math.random()*-200,vy:3+Math.random()*2}); }
    drawRain();
  }

  // Bienen
  game.bees.forEach(b=>{
    if(!b.caught){
      ctx.fillStyle='yellow';
      ctx.beginPath(); ctx.arc(b.x,b.y,5,0,2*Math.PI); ctx.fill();
      b.x += b.vx; b.y += b.vy;
      if(b.x>canvas.width || b.x<0) b.vx*=-1;
      if(b.y<0 || b.y>canvas.height-100) b.vy*=-1;
    }
  });

  requestAnimationFrame(draw);
}
draw();

// --- Interaktion ---
canvas.addEventListener('click',e=>{
  // Mulden nur auf Boden
  if(e.clientY>canvas.height-150){
    game.muldes.push({x:e.clientX,y:e.clientY,water:0});
    log('â› Mulde erstellt!');
  }
});

// Mini-Spiel: Bienenfangen
canvas.addEventListener('mousemove',e=>{
  // hier kÃ¶nnte man Kescher-Position setzen
});

document.getElementById('beeBtn').onclick=()=>{
  spawnBees(5);
  log('ğŸ Bienen fliegen! Fange sie!');
};

// Regen/Sonne Buttons
document.getElementById('rainBtn').onclick=()=>{
  game.rain=!game.rain;
  log(game.rain?'ğŸŒ§ Regen gestartet':'ğŸŒ§ Regen gestoppt');
};
document.getElementById('sunBtn').onclick=()=>{
  game.sun+=0.1;
  log('â˜€ï¸ Sonne verstÃ¤rkt Wachstum');
};

// Save/Load
const saveBtn=document.getElementById('saveBtn');
const loadBtn=document.getElementById('loadBtn');
const fileInput=document.getElementById('fileInput');

saveBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify(game)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download='pixel_garten_save.json'; a.click();
  URL.revokeObjectURL(url); log('ğŸ’¾ Spiel gespeichert');
};
loadBtn.onclick=()=>{fileInput.click();}
fileInput.onchange=()=>{
  const file=fileInput.files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    try{ game=JSON.parse(e.target.result); log('ğŸ“‚ Spiel geladen'); }
    catch(err){ log('Fehler beim Laden'); }
  };
  reader.readAsText(file);
};

</script>
</body>
</html>



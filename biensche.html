<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Perfekter Blumensimulator</title>
<style>
body { margin:0; overflow:hidden; background:#a0dca0; }
canvas { display:block; background:#88cc88;}
#status { position:absolute; top:10px; left:10px; color:white; font-family:sans-serif; background:rgba(0,0,0,0.3); padding:5px; border-radius:5px;}
</style>
</head>
<body>
<canvas id="canvas" width="900" height="600"></canvas>
<div id="status"></div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusDiv = document.getElementById('status');

// --- Kamera / Zoom / Pan ---
let camera = {x:0, y:0, scale:1};

// --- Spielzustand ---
let flowers = [];
let grass = [];
let particles = [];
let seeds = 0;

// --- Buttons ---
const buttons = {
  sun: {x:800, y:10, w:80, h:30, active:false},
  rain:{x:700, y:10, w:80, h:30, active:false}
};

// --- Gras initialisieren ---
for(let i=0;i<100;i++){
  grass.push({x: Math.random()*2000, y: 400 + Math.random()*50, height:2 + Math.random()*5, maxHeight:20});
}

// --- Blumenklasse ---
class Flower {
  constructor(x,y){
    this.x=x;
    this.y=y;
    this.stage=0;
    this.water=50;
    this.light=50;
    this.clean=50;
    this.alive=true;
    this.color='pink';
  }
  update(){
    if(!this.alive) return;
    this.water -=0.05;
    this.light -=0.02;
    this.clean -=0.01;
    if(buttons.rain.active) this.water +=0.3;
    if(buttons.sun.active) this.light +=0.2;
    // Wachstum
    if(this.water>30 && this.light>30 && this.clean>30 && this.stage<3){
      this.stage +=0.001;
    }
    if(this.stage>=3 && this.water>50 && this.light>50){
      this.color = Math.random()>0.5?'red':'purple';
    }
    if(this.water<10 || this.light<10 || this.clean<10){
      this.alive=false;
      seeds+=2;
    }
  }
  draw(){
    const stemHeight = 20 + this.stage*20;
    const stemWidth = 4 + this.stage*2;
    const size = 5 + this.stage*8;
    ctx.fillStyle = this.alive?'#228B22':'#654321';
    ctx.fillRect(this.x - stemWidth/2, this.y, stemWidth, stemHeight);
    // Blätter
    ctx.fillStyle=this.alive?'#2e8b57':'#3e3e3e';
    ctx.beginPath();
    ctx.ellipse(this.x-8, this.y+stemHeight/3, 3+this.stage,6+this.stage,-Math.PI/6,0,2*Math.PI); ctx.fill();
    ctx.beginPath();
    ctx.ellipse(this.x+8, this.y+stemHeight/2, 3+this.stage,6+this.stage,Math.PI/6,0,2*Math.PI); ctx.fill();
    // Blüte
    if(this.alive){
      ctx.fillStyle=this.color;
      for(let i=0;i<6;i++){
        let angle = (i/6)*2*Math.PI;
        let bx = this.x + Math.cos(angle)*size;
        let by = this.y - Math.sin(angle)*size;
        ctx.beginPath();
        ctx.ellipse(bx, by, size/2, size, angle,0,2*Math.PI);
        ctx.fill();
      }
      ctx.fillStyle='yellow';
      ctx.beginPath();
      ctx.arc(this.x, this.y, size/2,0,Math.PI*2); ctx.fill();
    }
  }
}

// --- Gras Update/Draw ---
function updateGrass(){
  grass.forEach(g=>{ if(g.height<g.maxHeight) g.height +=0.02; });
}
function drawGrass(){
  grass.forEach(g=>{
    ctx.fillStyle='#228B22';
    ctx.fillRect(g.x, 400+50-g.height,3,g.height);
  });
}

// --- Partikel ---
function spawnParticles(){
  if(buttons.rain.active){
    for(let i=0;i<3;i++){
      particles.push({x: Math.random()*2000, y:0, vy:2+Math.random()*2, color:'#00f'});
    }
  }
}
function updateParticles(){
  for(let i=particles.length-1;i>=0;i--){
    particles[i].y += particles[i].vy;
    if(particles[i].y>600) particles.splice(i,1);
  }
}
function drawParticles(){
  particles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x,p.y,2,2);
  });
}

// --- Buttons Draw ---
function drawButtons(){
  ctx.fillStyle=buttons.sun.active?'orange':'#ffcc00';
  ctx.fillRect(buttons.sun.x, buttons.sun.y, buttons.sun.w, buttons.sun.h);
  ctx.fillStyle='#000'; ctx.font='16px sans-serif'; ctx.fillText('Sonne', buttons.sun.x+15, buttons.sun.y+20);
  ctx.fillStyle=buttons.rain.active?'#00f':'#99ccff';
  ctx.fillRect(buttons.rain.x, buttons.rain.y, buttons.rain.w, buttons.rain.h);
  ctx.fillStyle='#000'; ctx.fillText('Regen', buttons.rain.x+15, buttons.rain.y+20);
}

// --- Status UI ---
function drawStatus(){
  statusDiv.innerHTML=`Blumen: ${flowers.length} | Samen: ${seeds} <br>R=Regen L=Sonne G=Gras schneiden B=Blume pflanzen + / - Zoom Pfeile/WASD Pan`;
}

// --- Main Loop ---
function loop(){
  ctx.save();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.scale(camera.scale,camera.scale);
  ctx.translate(camera.x,camera.y);
  // Hintergrund
  ctx.fillStyle='#87CEEB';
  ctx.fillRect(0,0,2000,400);
  ctx.fillStyle='#88cc88';
  ctx.fillRect(0,400,2000,200);
  // Update & Draw
  updateGrass();
  flowers.forEach(f=>f.update());
  spawnParticles();
  updateParticles();
  drawGrass();
  flowers.forEach(f=>f.draw());
  drawParticles();
  ctx.restore();
  drawButtons();
  drawStatus();
  requestAnimationFrame(loop);
}
loop();

// --- Input ---
window.addEventListener('keydown', e=>{
  if(e.key==='r') buttons.rain.active=!buttons.rain.active;
  if(e.key==='l') buttons.sun.active=!buttons.sun.active;
  if(e.key==='g'){
    grass.forEach(g=>g.height=Math.max(g.height-5,2));
    flowers.forEach(f=>f.clean+=5);
  }
  if(e.key==='b' && seeds>0){
    flowers.push(new Flower(100+Math.random()*1500,400+50));
    seeds--;
  }
  if(e.key==='=') camera.scale +=0.1;
  if(e.key==='-') camera.scale = Math.max(0.5,camera.scale-0.1);
  if(e.key==='ArrowUp') camera.y +=10;
  if(e.key==='ArrowDown') camera.y -=10;
  if(e.key==='ArrowLeft') camera.x +=10;
  if(e.key==='ArrowRight') camera.x -=10;
});

canvas.addEventListener('click', e=>{
  const rect=canvas.getBoundingClientRect();
  const mx=(e.clientX-rect.left)/camera.scale - camera.x;
  const my=(e.clientY-rect.top)/camera.scale - camera.y;
  // Buttons
  if(mx>buttons.sun.x && mx<buttons.sun.x+buttons.sun.w && my>buttons.sun.y && my<buttons.sun.y+buttons.sun.h) buttons.sun.active=!buttons.sun.active;
  if(mx>buttons.rain.x && mx<buttons.rain.x+buttons.rain.w && my>buttons.rain.y && my<buttons.rain.y+buttons.rain.h) buttons.rain.active=!buttons.rain.active;
  // Gras schneiden
  grass.forEach(g=>{
    if(mx>g.x && mx<g.x+3 && my>400+50-g.height && my<400+50){
      g.height=Math.max(g.height-5,2);
      flowers.forEach(f=>f.clean+=2);
    }
  });
});
</script>
</body>
</html>



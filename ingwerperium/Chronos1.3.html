<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Chronos â€“ Ã–kosystem 3.0</title>
<style>
body{margin:0;font-family:monospace;background:#071;color:#bfb;display:flex;height:100vh}
#left{flex:3;padding:15px;border-right:2px solid #3f3}
#right{flex:1;padding:15px;background:#020}
h1,h2{margin:0 0 10px}
#log{height:45%;overflow:auto;border:1px solid #3f3;padding:8px;background:#000}
#table{height:40%;overflow:auto;border:1px solid #3f3;margin-top:10px}
button{background:#040;color:#cfc;border:1px solid #3f3;padding:5px;margin:3px;cursor:pointer}
button:hover{background:#090}
</style>
</head>

<body>
<div id="left">
<h1>Chronos â€“ Ã–kosystem 3.0</h1>
<div id="log"></div>
<div id="table"></div>
<button onclick="running=!running">Start / Stop</button>
</div>

<div id="right">
<h2>Pflanzen</h2>
<div id="plants"></div>
<h2>Tiere</h2>
<div id="animals"></div>
</div>

<script>
/* ========= GRUNDLAGEN ========= */
const log = t => {
  const l=document.getElementById("log");
  l.innerText+=t+"\n";
  l.scrollTop=l.scrollHeight;
};

let running=true;
let year=0;
let seasonIndex=0;
const seasons=["FrÃ¼hling","Sommer","Herbst","Winter"];

/* ========= ARTEN-DEFINITION ========= */
const species={
  // ðŸŒ± Pflanzen
  Gras:{typ:"pflanze",wachstum:0.4,max:1200},
  Beeren:{typ:"pflanze",wachstum:0.25,max:600},
  Eiche:{typ:"pflanze",wachstum:0.05,max:300},
  Pilze:{typ:"pflanze",wachstum:0.2,max:500,symbiose:["Eiche"]},
  Algen:{typ:"pflanze",wachstum:0.6,max:2000},

  // ðŸ› Pflanzenfresser
  Raupe:{typ:"tier",frisst:["Gras","Beeren"],wachstum:0.3,max:400,krankheit:"Pilzbefall"},
  Hase:{typ:"tier",frisst:["Gras","Beeren"],wachstum:0.2,max:250},
  Reh:{typ:"tier",frisst:["Gras","Beeren"],wachstum:0.15,max:180},
  Fisch:{typ:"tier",frisst:["Algen"],wachstum:0.25,max:400},

  // ðŸ¦… RÃ¤uber
  Vogel:{typ:"tier",frisst:["Raupe"],wachstum:0.2,max:150},
  Fuchs:{typ:"tier",frisst:["Hase","Raupe"],wachstum:0.12,max:90},
  Wolf:{typ:"tier",frisst:["Reh","Hase"],wachstum:0.08,max:70},
  Otter:{typ:"tier",frisst:["Fisch"],wachstum:0.1,max:60},
};

/* ========= KRANKHEITEN ========= */
const diseases={
  Pilzbefall:{
    chance:0.25,
    verlust:0.2
  },
  Seuche:{
    chance:0.15,
    verlust:0.3
  }
};

/* ========= WELT ========= */
let world={};
Object.keys(species).forEach(s=>world[s]=0);

/* ========= UI ========= */
function draw(){
  const t=document.getElementById("table");
  t.innerHTML=`Jahr ${year} â€“ ${seasons[seasonIndex]}<br><br>`;
  Object.entries(world).forEach(([k,v])=>{
    if(v>0) t.innerHTML+=`${k}: ${v}<br>`;
  });
}

/* ========= LOGIK ========= */
function step(){
  year++;
  seasonIndex=(seasonIndex+1)%4;
  const season=seasons[seasonIndex];
  log(`--- Jahr ${year} (${season}) ---`);

  /* Wachstum */
  Object.entries(species).forEach(([name,sp])=>{
    if(world[name]<=0) return;

    let seasonFactor=1;
    if(season==="Winter" && sp.typ==="pflanze") seasonFactor=0.3;
    if(season==="FrÃ¼hling") seasonFactor=1.3;

    let foodFactor=1;
    if(sp.frisst){
      const food=sp.frisst.reduce((s,f)=>s+(world[f]||0),0);
      if(food<=0) foodFactor=0.25;
    }

    let symbioseBonus=1;
    if(sp.symbiose){
      sp.symbiose.forEach(p=>{
        if(world[p]>0) symbioseBonus+=0.2;
      });
    }

    const delta=Math.floor(
      world[name]*sp.wachstum*seasonFactor*foodFactor*symbioseBonus*
      (1-world[name]/sp.max)
    );

    if(delta>0){
      world[name]+=delta;
      log(`${name} wÃ¤chst (+${delta})`);
    }
  });

  /* Fressen */
  Object.entries(species).forEach(([pred,sp])=>{
    if(!sp.frisst||world[pred]<=0) return;
    sp.frisst.forEach(prey=>{
      if(world[prey]>0){
        const eat=Math.min(world[prey],Math.floor(world[pred]*0.2));
        if(eat>0){
          world[prey]-=eat;
          log(`${pred} frisst ${prey} (-${eat})`);
        }
      }
    });
  });

  /* Krankheiten */
  Object.entries(species).forEach(([name,sp])=>{
    if(world[name]<=0||!sp.krankheit) return;
    const d=diseases[sp.krankheit];
    if(Math.random()<d.chance){
      const loss=Math.floor(world[name]*d.verlust);
      world[name]-=loss;
      log(`âš ï¸ ${name} leidet an ${sp.krankheit} (-${loss})`);
    }
  });

  draw();
}

/* ========= START ========= */
setInterval(()=>{ if(running) step(); },1200);

/* ========= BUTTONS ========= */
const p=document.getElementById("plants");
const a=document.getElementById("animals");

Object.entries(species).forEach(([n,s])=>{
  const b=document.createElement("button");
  b.innerText=n;
  b.onclick=()=>{world[n]+=s.typ==="pflanze"?50:10;log(`${n} erschaffen`);draw();};
  (s.typ==="pflanze"?p:a).appendChild(b);
});

draw();
</script>
</body>
</html>

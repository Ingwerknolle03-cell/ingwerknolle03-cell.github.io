<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Pixelgarten Deluxe</title>
<style>
body { margin:0; overflow:hidden; background:#87ceeb; font-family:monospace; }
#gameUI { position:absolute; top:10px; left:10px; z-index:10; }
button { font-size:14px; padding:5px 8px; margin:3px; cursor:pointer; }
#log { position:absolute; bottom:10px; left:10px; width:400px; max-height:200px; overflow-y:auto; background:rgba(255,255,255,0.8); border:1px solid #0a0; padding:5px; font-size:12px; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="gameUI">
  <button id="sunBtn">â˜€ï¸ Sonne geben</button>
  <button id="rainBtn">ğŸŒ§ Regen an/aus</button>
  <button id="beeGameBtn">ğŸ Bienenfangen</button>
  <button id="feedBirdBtn">ğŸŒ° Vogel fÃ¼ttern</button>
  <button id="saveBtn">ğŸ’¾ Speichern</button>
  <button id="loadBtn">ğŸ“‚ Laden</button>
  <input type="file" id="fileInput" style="display:none;" accept=".json" />
</div>
<div id="log"></div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const logDiv = document.getElementById('log');
function log(text){ const p = document.createElement('div'); p.textContent = text; logDiv.appendChild(p); logDiv.scrollTop = logDiv.scrollHeight; }

// Game state
let game = {
  flowers: [],
  seedPlanted: false,
  flowerGrowth: 0,
  muldes: [],
  bees: [],
  rain:false,
  sun:1,
  nectar:0,
  birdFed:false
};

// Vogel
let bird = {x:-100,y:150,targetX:300,targetY:300,angle:0,onTree:false};
let tree = {x:canvas.width-200,y:canvas.height-200};

// HÃ¼gel generieren
let hills = [];
for(let i=0;i<canvas.width;i+=50){
  hills.push({x:i,y:canvas.height-50-Math.random()*50});
}

// Blumen-Objekt
function createFlower(x,y){ return {x,y,size:0,health:0}; }

// Zeichenloop
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Himmel
  ctx.fillStyle='#87ceeb'; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Sonne
  ctx.beginPath(); ctx.arc(100,100,50,0,Math.PI*2); ctx.fillStyle='#fff200'; ctx.fill();

  // Regen
  if(game.rain){ ctx.fillStyle='rgba(0,0,255,0.3)'; for(let i=0;i<100;i++){ ctx.fillRect(Math.random()*canvas.width,Math.random()*canvas.height,2,10); } }

  // HÃ¼gel
  ctx.fillStyle='#0a5'; ctx.beginPath();
  ctx.moveTo(0,canvas.height);
  hills.forEach(h=>ctx.lineTo(h.x,h.y));
  ctx.lineTo(canvas.width,canvas.height);
  ctx.fill();

  // Mulden
  ctx.fillStyle='#0077aa'; game.muldes.forEach(m=>{ ctx.beginPath(); ctx.ellipse(m.x,m.y,20,10,0,0,Math.PI*2); ctx.fill(); });

  // Blumen
  game.flowers.forEach(f=>{
    if(f.health>5){ f.size+=0.001*(1+game.sun+game.nectar); if(f.size>1) f.size=1; }
    ctx.fillStyle='#ffcc00'; ctx.beginPath(); ctx.arc(f.x,f.y-50*f.size,10*f.size,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#0a0'; ctx.fillRect(f.x-2,f.y,4,50*f.size);
  });

  // Vogel
  if(!game.birdFed){
    drawBird(bird.x,bird.y);
  }else{
    if(!bird.onTree){
      let dx = tree.x-bird.x; let dy = tree.y-bird.y;
      bird.x+=dx*0.02; bird.y+=dy*0.02;
      if(Math.abs(dx)<2 && Math.abs(dy)<2){ bird.onTree=true; log('ğŸ¦ Vogel sitzt auf dem Baum!'); plantSeed(bird.x,bird.y); }
      drawBird(bird.x,bird.y);
    } else drawBird(tree.x,tree.y-50);
  }

  // Bienen
  game.bees.forEach(b=>{ ctx.fillStyle='#ff0'; ctx.beginPath(); ctx.arc(b.x,b.y,5,0,Math.PI*2); ctx.fill(); b.x+=b.vx; b.y+=b.vy; });

  requestAnimationFrame(draw);
}
draw();

function drawBird(x,y){
  // KÃ¶rper
  ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
  // Auge
  ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(x+8,y-5,3,0,Math.PI*2); ctx.fill();
  // Schnabel
  ctx.fillStyle='#ff0'; ctx.beginPath(); ctx.moveTo(x+20,y); ctx.lineTo(x+30,y-5); ctx.lineTo(x+30,y+5); ctx.closePath(); ctx.fill();
}

function plantSeed(x,y){
  if(!game.seedPlanted){
    game.seedPlanted=true;
    game.flowers.push(createFlower(x,y));
    log('ğŸŒ¼ Ringelblume gesÃ¤t!');
  }
}

// UI Buttons
document.getElementById('sunBtn').onclick = ()=>{ game.sun+=0.2; log('â˜€ï¸ Sonne erhÃ¶ht!'); };
document.getElementById('rainBtn').onclick = ()=>{ game.rain=!game.rain; log(game.rain?'ğŸŒ§ Regen beginnt':'ğŸŒ¤ Regen endet'); if(game.rain) game.flowers.forEach(f=>f.health+=0.2); };
document.getElementById('beeGameBtn').onclick = ()=>{ for(let i=0;i<5;i++){ game.bees.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height/2,vx:1+Math.random()*2,vy:(Math.random()-0.5)*1}); } log('ğŸ Bienen fliegen!'); };
document.getElementById('feedBirdBtn').onclick = ()=>{ game.birdFed=true; log('ğŸŒ° Vogel gefÃ¼ttert! Er fliegt zum Baum.'); };

// Mulden nur auf Wiese
canvas.addEventListener('click',e=>{ if(e.clientY>canvas.height-150){ game.muldes.push({x:e.clientX,y:e.clientY}); log('â› Mulde erstellt'); } });

// Save/Load
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const fileInput = document.getElementById('fileInput');
saveBtn.onclick = ()=>{
  const dataStr=JSON.stringify(game);
  const blob=new Blob([dataStr],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='pixelgarten_save.json'; a.click(); URL.revokeObjectURL(url);
  log('ğŸ’¾ Spiel gespeichert');
};
loadBtn.onclick=()=>{fileInput.click();};
fileInput.onchange=()=>{
  const file=fileInput.files[0];
  const reader=new FileReader();
  reader.onload=e=>{ try{ game=JSON.parse(e.target.result); log('ğŸ“‚ Spiel geladen'); }catch(err){log('Fehler beim Laden');} };
  reader.readAsText(file);
};
</script>
</body>
</html>


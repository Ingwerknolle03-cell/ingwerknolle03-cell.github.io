<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>biensche</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #a0d8ef;
  font-family: monospace;
}
#gameUI {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 10;
}
button {
  font-size: 14px;
  padding: 5px 8px;
  margin: 3px;
  cursor: pointer;
}
#log {
  position: absolute;
  bottom: 10px;
  left: 10px;
  width: 300px;
  max-height: 200px;
  overflow-y: auto;
  background: rgba(255,255,255,0.7);
  border: 1px solid #0a0;
  padding: 5px;
  font-size: 12px;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="gameUI">
  <button id="waterBtn">üíß</button>
  <button id="sunBtn">‚òÄÔ∏è</button>
  <button id="rainBtn">üåß</button>
  <button id="beeGameBtn">üêù</button>
  <button id="saveBtn">Speichern</button>
  <button id="loadBtn">Laden</button>
  <input type="file" id="fileInput" style="display:none;" accept=".json" />
</div>
<div id="log"></div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const logDiv = document.getElementById('log');
function log(text){
  const p = document.createElement('div');
  p.textContent = text;
  logDiv.appendChild(p);
  logDiv.scrollTop = logDiv.scrollHeight;
}

// Game State
let game = {
  flowers: [],
  seedPlanted: false,
  flowerGrowth: 0,
  muldes: [],
  bees: [],
  rain: false,
  sun: 1,
  nectar: 0
};

// Vogel Einf√ºhrung
let bird = {x:-100,y:100,targetX:300,targetY:100,hasSeed:false};

// Animation Loop
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Himmel
  ctx.fillStyle = '#a0d8ef';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Sonne
  ctx.beginPath();
  ctx.arc(100,100,50,0,Math.PI*2);
  ctx.fillStyle = '#fff200';
  ctx.fill();

  // Wolken
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(400,80,40,0,Math.PI*2);
  ctx.arc(440,80,35,0,Math.PI*2);
  ctx.arc(420,60,30,0,Math.PI*2);
  ctx.fill();

  // Gras
  ctx.fillStyle = '#0a0';
  for(let i=0;i<canvas.width;i+=5){
    const height = 20+5*Math.sin((i+Date.now()/100)/50);
    ctx.fillRect(i,canvas.height-height,2,height);
  }

  // Mulden
  ctx.fillStyle = '#0077aa';
  game.muldes.forEach(m=>{
    ctx.beginPath();
    ctx.ellipse(m.x,m.y,20,10,0,0,Math.PI*2);
    ctx.fill();
  });

  // Vogel
  if(!game.seedPlanted){
    ctx.fillStyle='#f00';
    ctx.beginPath();
    ctx.arc(bird.x,bird.y,20,0,Math.PI*2);
    ctx.fill();
    if(bird.x<bird.targetX) bird.x+=2;
    else if(!bird.hasSeed){
      log('üê¶ Vogel bringt Samen!');
      bird.hasSeed=true;
    }
    else{
      // Samen f√§llt
      game.seedPlanted=true;
      game.flowers.push({x:bird.x,y:bird.y,size:0});
      log('üåº Ringelblumen-Samen f√§llt auf die Erde!');
    }
  }

  // Blumen
  game.flowers.forEach(f=>{
    f.size += 0.001*(1+game.sun+game.nectar);
    if(f.size>1) f.size=1;
    ctx.fillStyle='#ffcc00';
    ctx.beginPath();
    ctx.arc(f.x,f.y-50*f.size,10*f.size,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle='#0a0';
    ctx.fillRect(f.x-2,f.y,4,50*f.size);
  });

  // Bienen
  game.bees.forEach(b=>{
    ctx.fillStyle='#ff0';
    ctx.beginPath();
    ctx.arc(b.x,b.y,5,0,Math.PI*2);
    ctx.fill();
    b.x+=b.vx;
    b.y+=b.vy;
  });

  requestAnimationFrame(draw);
}
draw();

// UI Actions
document.getElementById('waterBtn').onclick = ()=>{
  log('Ahhh, Wasserüíß!');
  game.nectar+=0.1;
};
document.getElementById('sunBtn').onclick = ()=>{
  log('‚òÄÔ∏è');
  game.sun+=0.1;
};
document.getElementById('rainBtn').onclick = ()=>{
  game.rain=!game.rain;
  log(game.rain?'iieh, jetzt werde ich ja nassüåß ':'üåß Regen endet');
  if(game.rain){
    // Mulden f√ºllen
    game.muldes.forEach(m=>game.nectar+=0.5);
  }
};
document.getElementById('beeGameBtn').onclick = ()=>{
  // spawn bees
  for(let i=0;i<5;i++){
    game.bees.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height/2,vx:1+Math.random()*2,vy:(Math.random()-0.5)*1});
  }
  log('üêù Bienen fliegen! Fange sie!');
};

// Save/Load via JSON
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const fileInput = document.getElementById('fileInput');

saveBtn.onclick = ()=>{
  const dataStr = JSON.stringify(game);
  const blob = new Blob([dataStr],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url;
  a.download='pixel_garten_save.json';
  a.click();
  URL.revokeObjectURL(url);
  log('üíæ Spiel gespeichert');
};

loadBtn.onclick = ()=>{fileInput.click();};
fileInput.onchange = ()=>{
  const file = fileInput.files[0];
  const reader = new FileReader();
  reader.onload = e=>{
    try{
      game = JSON.parse(e.target.result);
      log('üìÇ Spiel geladen');
    }catch(err){log('Fehler beim Laden');}
  };
  reader.readAsText(file);
};

// Click auf Canvas f√ºr Mulden
canvas.addEventListener('click', e=>{
  game.muldes.push({x:e.clientX,y:e.clientY});
  log('‚õè');
});
</script>
</body>
</html>
